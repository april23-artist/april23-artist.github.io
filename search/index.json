[{"content":"前言 Multipass 是輕量化的虛擬機管理工具，選擇搭配 k3s 而不選擇 minikube 是因為 k3s 可以建立多個 node ，非常適合用來學習 k8s 的知識。\n步驟 安裝 Multipass 1 choco install multipass 建立虛擬機 (nodes) 共建立 3 個 node ，1 個 master，2 個 worker 。\n1 2 3 multipass launch --name k8s-master --cpus 1 --memory 4G --disk 10G multipass launch --name k8s-node1 --cpus 1 --memory 4G --disk 10G multipass launch --name k8s-node2 --cpus 1 --memory 4G --disk 10G 常用的 Multipass 指令\n1 2 3 4 5 6 multipass ls # 虛擬機列表 multipass start \u0026lt;nodename\u0026gt; # 啟動虛擬機 multipass stop \u0026lt;nodename\u0026gt; # 關閉虛擬機 multipass shell \u0026lt;nodename\u0026gt; # 進入虛擬機 multipass delete \u0026lt;nodename\u0026gt; # 刪除虛擬機 multipass purge # 清除已刪除虛擬機 在 master node 建立 k3s 1 curl -sfL https://get.k3s.io | sh - 查看 k3s 配置文件\n1 cat /etc/rancher/k3s/k3s.yaml 安裝後即可使用 kubectl 指令\n1 kubectl get nodes 將 worker nodes 加入 master 叢集 輸入 exit 指令離開 master node 。\n1 2 3 4 5 6 # 取得 Token $TOKEN = multipass exec k8s-master -- cat /var/lib/rancher/k3s/server/node-token # 取得 IP $MASTER_IP = (multipass info k8s-master | Select-String \u0026#34;IPv4\u0026#34; | ForEach-Object { $_ -replace \u0026#39;IPv4:\\s*\u0026#39;, \u0026#39;\u0026#39; }).Trim() # 將 Token, IP 指定給 worker nodes For ($f = 1; $f -le 2; $f++) { multipass exec \u0026#34;k8s-node$f\u0026#34; -- bash -c \u0026#34;curl -sfL https://get.k3s.io | K3S_URL=\u0026#39;https://$($MASTER_IP):6443\u0026#39; K3S_TOKEN=\u0026#39;$TOKEN\u0026#39; sh -\u0026#34; } 建立 master 與 worker nodes 的 SSH 進入 master node 產生 SSH 密鑰。\n1 2 3 4 5 6 # 確認 master node 是否有 SSH 密鑰 cat ~/home/ubuntu~/.ssh/id_rsa.pub # 若沒有則產生 SSH 密鑰 ssh-keygen -t rsa -b 4096 # 取得 SSH 密鑰 cat ~/.ssh/id_rsa.pub worker nodes 調整 SSH 配置 每個 worker node 都要執行。 檢查 SSH 服務是否開啟。\n1 systemctl status ssh 調整 SSH 配置。\n1 2 3 4 5 6 7 8 9 # 進入設定檔 nano /etc/ssh/sshd_config # 確保以下設置未被註解（即沒有 #） PubkeyAuthentication yes AuthorizedKeysFile .ssh/authorized_keys # 重新啟動 SSH 服務 systemctl restart ssh # 將 master SSH 密鑰寫入授權金鑰 echo \u0026#34;master SSH 密鑰\u0026#34; \u0026gt;\u0026gt; ~/.ssh/authorized_keys 在 master node 測試 SSH 是否有通。\n1 ssh \u0026lt;worker nodename\u0026gt; 將 master node 的 k3s.yaml 配置複製到 worker nodes 進入 master node 複製 k3s.yaml 到 worker nodes 。\n1 2 3 4 5 6 7 8 # SSH 密鑰複製到 root 用戶 cp ~/.ssh/id_rsa /root/.ssh/ cp ~/.ssh/id_rsa.pub /root/.ssh/ # 設定權限 chmod 600 /root/.ssh/id_rsa chmod 644 /root/.ssh/id_rsa.pub # 複製 k3s.yaml 到worker nodes scp /etc/rancher/k3s/k3s.yaml ubuntu@k8s-node1:/tmp/k3s.yaml 進入 worker nodes ，將 k3s.yaml 的 server 改為 master node 的 IP 。\n1 2 3 4 5 6 7 8 9 10 # 檢查目錄是否存在 ls /etc/rancher/k3s/ # 建立 /etc/rancher/k3s/ 目錄 mkdir -p /etc/rancher/k3s/ # 確保 /tmp/k3s.yaml 文件存在後移動文件 mv /tmp/k3s.yaml /etc/rancher/k3s/k3s.yaml # 進入 k3s.yaml nano /etc/rancher/k3s/k3s.yaml # 修改 server 變數 server: https://\u0026lt;master_ip\u0026gt;:6443 設定 worker nodes 的 KUBECONFIG 進入 worker node 添加 KUBECONFIG 環境變數。\n1 2 3 4 5 nano ~/.bash_profile # 添加環境變數 export KUBECONFIG=/etc/rancher/k3s/k3s.yaml # 使變更生效 source ~/.bash_profile (補充) 若 master node IP 改變，則調整 worker nodes 的設定重新加入叢集 進入 worker nodes 編輯環境變數文件。\n1 2 3 4 nano /etc/systemd/system/k3s-agent.service.env #重新載入和重啟服務 systemctl daemon-reload systemctl restart k3s-agent 參考 Multipass k3s Kubernetes 1 小時入門 ","date":"2024-12-25T00:00:00Z","permalink":"https://april23-artist.github.io/p/multipass-k3s/","title":"Multipass 搭配 k3s 建立 Kubernetes Cluster"},{"content":"前言 想紀錄開發筆記，決定透過 GitHub Actions 自動化部署 Hugo 到 GitHub Pages 。\n步驟 Windows 安裝 Hugo 安裝 Chocolatey ，使用管理員身分開啟 Windows Terminal 。\n1 Set-ExecutionPolicy Bypass -Scope Process -Force; [System.Net.ServicePointManager]::SecurityProtocol = [System.Net.ServicePointManager]::SecurityProtocol -bor 3072; iex ((New-Object System.Net.WebClient).DownloadString(\u0026#39;https://community.chocolatey.org/install.ps1\u0026#39;)) 安裝 Hugo ，並確認 Hugo 版本。\n1 2 3 choco install hugo choco install hugo-extended hugo version 建立 GitHub Repository 建立名稱為 \u0026lt;username\u0026gt;.github.io 的 Repo 作為 Hugo 的專案。 這裡使用的 hugo theme 為 Stask ，直接使用 hugo-theme-stack-stater 範例來修改。 將 hugo-theme-stack-stater 內的檔案放入 \u0026lt;username\u0026gt;.github.io 。\n1 git clone https://github.com/CaiJimmy/hugo-theme-stack-starter.git hugo-theme-stack-starter 因為環境未安裝 Go 在執行 hugo build 時會出錯，所以要稍微調整。 範例專案沒有 theme ，需下載 hugo-theme-stack。\n1 git clone https://github.com/CaiJimmy/hugo-theme-stack.git themes/hugo-theme-stack 將專案內 go.mod, go.sum 刪除。 並調整 config \u0026gt; _default \u0026gt; module.toml 。\n1 2 - path = \u0026#34;github.com/CaiJimmy/hugo-theme-stack/v3\u0026#34; + path = \u0026#34;hugo-theme-stack\u0026#34; 建置並啟動網站，若成功啟動網站即可將專案 push 到 GitHub 。\n1 2 hugo build hugo server --disableFastRender 設定 GitHub Pages 新增分支 gh-pages 。 Settings \u0026gt; (Code and automation) Pages \u0026gt; (Build and deployment) Branch 設定為分支 gh-pages/(root) 。\n設定 Workflow 在分支 main 將範例原本的 .github\\workflows\\deploy.yaml 內容替換，並 push 到 GitHub ，將會自動化部署到 gh-pages 分支。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 name: Deploy Hugo site to GitHub Pages # 設定在 `push` 事件觸發時運行工作流。你可以根據需求修改觸發條件。 on: push: branches: - main # 當推送到 main 分支時觸發 # 定義工作流程的各個步驟 jobs: deploy: runs-on: ubuntu-latest # 使用最新版本的 Ubuntu 運行此工作流 steps: # 1. Checkout repository (將代碼庫檢出到 runner) - name: Checkout code uses: actions/checkout@v3 # 2. 設置 Hugo 環境 - name: Set up Hugo uses: peaceiris/actions-hugo@v2 with: hugo-version: latest extended: true # 3. 安裝 Hugo 主題 - name: Install Hugo theme run: | git clone https://github.com/CaiJimmy/hugo-theme-stack.git themes/hugo-theme-stack # 4. 建構 Hugo 網站 - name: Build the site working-directory: ./ run: hugo --minify --gc --cleanDestinationDir # 5. 部署到 GitHub Pages (gh-pages 分支) - name: Deploy to GitHub Pages uses: JamesIves/github-pages-deploy-action@v4 with: branch: gh-pages # 部署到 gh-pages 分支 folder: public # Hugo 網站的輸出目錄 clean: true # 部署之前清理已有的文件 參考 Stack 在 Windows 中安裝 Hugo ","date":"2024-12-24T00:00:00Z","permalink":"https://april23-artist.github.io/p/deploy-hugo-to-github-pages/","title":"部署 Hugo 到 GitHub Pages"}]